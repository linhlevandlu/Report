\chapter{Classification methods }
In previous chapter, we introduce a method to remove the unexpected object. In this chapter, we will introduce a method to obtain the features that we are interested in and the landmarks on the insect. The method was proposed by Palaniswamy$^{\cite{palaniswamy2010automatic}}$.
\section{Preprocessing image and feature extraction}
Feature extraction stage is duration that we extract essential information from the digital images and retaining only these features that we are interested in. To obtain the good result, before extracting the features in the image, we need to pre-process the image with a appropriate technique to reduce the noise as well as enhance the features that we care. The expect result in this result is list of pairwise lines which use to construct the pairwise histogram in the next step.
\subsection{Preprocess image}
In this application, we use the threshold technique to preprocess the image. With a threshold value ``t", we can decrease the noise and obtain the interested in features. The threshold value was indicated by the histogram analysis. Based on the histogram of the image, we compute the mean and median of this histogram. After that, we split the histogram into two parts: the first part begin from the bin 0 to the limit value (the limit value is smallest value between mean and median); the second part, starting from the limit value to the end of histogram. For each part, we find the maximum and minimum value and calculating the mean of it. The value ``t" obtained by the mean of two mean value in two parts of histogram.\\
With the threshold value ``t", we apply the threshold technique to pre-process image in the CV\_THRESH\_BINARY mode.\\
\IncMargin{1em}
\begin{algorithm}[H]
\Indm 
\KwData{inputImage: the input image}
\KwResult{outputImage: the image after processing}
\Indp
Convert the input image into gray scale image\;
Calculate the histogram on gray scale image\;
Compute the $mean$ value and $median$ value of histogram\;
$limit \leftarrow (mean > median ? median: mean)$\;
\For{$i \leftarrow 0 to limit$}{
	$imax1 \leftarrow$ maximal bin of histogram \; 
	$imin \leftarrow$ minimal bin of histogram \; 
}
$middle1 \leftarrow (imax1 + imin)/2$ \;
\For{$i \leftarrow limit to end\_of\_bins$}{
	$imax2 \leftarrow$ maximal bin of histogram \; 
}
$middle2 \leftarrow (imax2 + imin)/2$ \;
$middle \leftarrow (middle1 + middle2)/2$ \;
Apply the threshold with threshold value is $middle$\;
\caption{Algorithm to preprocess image}
\end{algorithm}\DecMargin{1em}
\subsection{Feature extraction}
In this stage, we apply the Canny algorithm to detect the step edges, which incorporates non-maximal suppression and hysteresis thresholding. But, the Canny algorithm is not aware of actual edges, the edge detecting was based on the Sobel operator, extracted with non-maximal suppression. Canny does not connect pixels into chains or segments. So, after using the Canny, we apply another technique â€“ find contours,  to get the set of edges. After apply the \textbf{findContours}, we will have a set of edges, it was presented by a vector of the edges, and each edge was presented by a vector of the points.
\subsection{Segmentation edge}
Now, in this step, we will segment the edges which obtain from the previous step. It mean, we will separate the edge into many straight line. To do that, we apply an algorithm is similar with algorithm proposed by Lowe.\\
\IncMargin{1em}
\begin{algorithm}[H]
\Indm 
\KwData{listPoints: list of points which presented the edge}
\KwResult{Queue of ``step" points on the edge}
\Indp
Set up a straight line between the endpoints of the edges (line d)\;
Initialization the max value: $maxDistance  \leftarrow -1 $\;
Split point: $imax \leftarrow -1$ \; 
\For{ point $p$ on edges}{
	distance $\leftarrow$ from $p$ to line $d$\;
	\If{distance > max\_distance}{
		maxDistance $\leftarrow$ distance\;
		iamx $\leftarrow$ position of p\;
	}
}
$\lambda \leftarrow $ maxDistance$/$length(d)\;
ratio $ \leftarrow $ maxDistance$/$length(p0-imax)\;
\If{ratio $> \lambda$ }{
	split the list of points into 2 parts\;
	preprocess on each part\;
}
\If {imax $ = -1$}{
	push imax into queue\;\tcp{queue is a variable of class}
}
\caption{Algorithm to segment an edge}
\end{algorithm}\DecMargin{1em}
\subsection{Algorithm}
The process to extract the features can be summerised as follows:
\begin{enumerate}
\item Calculating the histogram of image (in gray-scale mode)
\item Computing the mean and median value.
\item Computing the threshold value t.
\item Applying the thresholding technique
\item Applying the Canny and findContours to obtained the step edges.
\item Segmentation the edges.
\end{enumerate}
\section{Pairwise geometric histogram}
\section{Probabilistic Hough Transform}